{"version":3,"sources":["../../../src/libs/database/index.js"],"names":["init","mongoose","require","Promise","resolve","reject","url","process","env","MONGODB_URI","conn","connection","once","console","log","on","error","close","exit","connect"],"mappings":";;;;;;;;;;QAcgBA,I,GAAAA,I;;AAZhB;;;;AAFA,IAAMC,WAAWC,QAAQ,UAAR,CAAjB;;AAOAD,SAASE,OAAT;;AAEA;;;;;AAKO,SAASH,IAAT,GAAgB;AACnB,WAAO,sBAAY,UAACI,OAAD,EAAUC,MAAV,EAAqB;AACpC,YAAIC,MAAMC,QAAQC,GAAR,CAAYC,WAAZ,IAA2B,iCAArC;AACA,YAAIC,OAAOT,SAASU,UAApB;;AAEAD,aAAKE,IAAL,CAAU,MAAV,EAAkB,YAAM;AACpBC,oBAAQC,GAAR,CAAY,yCAAyCR,GAArD;;AAEA,4BAAQN,IAAR;AACA,2BAAOA,IAAP;;AAEAI,oBAAQM,IAAR;AACH,SAPD;;AASAA,aAAKK,EAAL,CAAQ,OAAR,EAAiB,UAACC,KAAD;AAAA,mBAAWX,OAAOW,KAAP,CAAX;AAAA,SAAjB;;AAEA;AACAN,aAAKK,EAAL,CAAQ,cAAR,EAAwB,YAAM;AAC1BF,oBAAQC,GAAR,CAAY,0CAAZ;AACH,SAFD;;AAIA;AACAP,gBAAQQ,EAAR,CAAW,QAAX,EAAqB,YAAM;AACvBL,iBAAKO,KAAL,CAAW,YAAM;AACbJ,wBAAQC,GAAR,CAAY,kEAAZ;AACAP,wBAAQW,IAAR,CAAa,CAAb;AACH,aAHD;AAIH,SALD;;AAOAjB,iBAASkB,OAAT,CAAiBb,GAAjB;AACH,KA7BM,CAAP;AA8BH","file":"index.js","sourcesContent":["const mongoose = require('mongoose');\n\nimport {\n    Account,\n    Online\n} from './models';\n\nmongoose.Promise = Promise;\n\n/**\n * 初始化 mongoose\n * @export\n * @returns Promise<mongoose.Connection>\n */\nexport function init() {\n    return new Promise((resolve, reject) => {\n        let url = process.env.MONGODB_URI || 'mongodb://localhost/mos-livemap';\n        let conn = mongoose.connection;\n\n        conn.once('open', () => {\n            console.log('Mongoose default connection open to ' + url);\n\n            Account.init();\n            Online.init();\n\n            resolve(conn);\n        })\n\n        conn.on('error', (error) => reject(error));\n\n        // When the connection is disconnected\n        conn.on('disconnected', () => {\n            console.log('Mongoose default connection disconnected');\n        });\n\n        // If the Node process ends, close the Mongoose connection\n        process.on('SIGINT', () => {\n            conn.close(() => {\n                console.log('Mongoose default connection disconnected through app termination');\n                process.exit(0);\n            });\n        });\n\n        mongoose.connect(url);\n    });\n}"]}